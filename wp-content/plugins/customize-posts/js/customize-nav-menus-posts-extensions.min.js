wp.customize.Posts.NavMenusExtensions=function(t,e){"use strict";var i={};return t.Menus.insertAutoDraftPost&&(t.Menus.insertAutoDraftPost=function(i){var n,s=e.Deferred();return(n=t.Posts.insertAutoDraftPost(i.post_type)).done(function(e){var n;(n=_.clone(e.setting.get())).post_title=i.post_title,n.post_status="publish",e.setting.set(n),s.resolve({post_id:e.postId,url:t.Posts.getPostUrl({post_id:e.postId,post_type:i.post_type})})}),n.fail(function(t){s.reject(t)}),s.promise()}),i.addEditPostButton=function(i){var n,s,o=i.setting.get();"post_type"===o.type&&o.object_id&&(n=t.Posts.data.postTypes[o.object])&&n.current_user_can.edit_published_posts&&((s=e(wp.template("customize-posts-edit-nav-menu-item-original-object")({editItemLabel:n.labels.edit_item}))).on("click",function(){t.Posts.startEditPostFlow({postId:o.object_id,initiatingButton:s,originatingConstruct:i,restorePreviousUrl:!0,returnToOriginatingConstruct:!0})}),i.container.find(".menu-item-actions > .link-to-original").append(s))},i.syncOriginalItemTitle=function(i){var n,s=i.setting.get();"post_type"===s.type&&s.object_id&&t.Posts.data.postTypes[s.object]&&(n="post["+String(s.object)+"]["+String(s.object_id)+"]",t(n,function(n){var s=function(n,s){var o,a,r,l;s&&n.post_title===s.post_title||(o=e.trim(n.post_title)||t.Posts.data.l10n.noTitle),"resolved"===i.deferred.embedded.state()&&(i.container.find(".menu-item-actions > .link-to-original > .original-link").text(o),i.container.find(".edit-menu-item-title:first").attr("placeholder",o)),!1!==i.setting.get()&&((a=_.clone(i.setting.get())).original_title=n.post_title,i.setting._value=a,i.setting.preview(),r=i.container.find(".menu-item-title"),l=a.title||a.original_title||t.Menus.data.l10n.untitled,a._invalid&&(l=t.Menus.data.l10n.invalidTitleTpl.replace("%s",l)),a.title||a.original_title?r.text(l).removeClass("no-title"):r.text(l).addClass("no-title"))};n.bind(s),s(n.get(),null)}))},i.extendNavMenuItemOriginalObjectReference=function(e){var n;e.extended(t.Menus.MenuItemControl)&&(i.syncOriginalItemTitle(e),n=function(t){t&&(e.expanded.unbind(n),i.addEditPostButton(e))},e.deferred.embedded.done(function(){e.expanded.get()?n():e.expanded.bind(n)}))},i.watchPostSettingChanges=function(i){var n,s,o,a,r,l,d;"post["===i.id.substr(0,"post[".length)&&(n=i.id.substr("post[".length).replace(/]/g,"").split("["),(s=parseInt(n[1],10))&&(a=i.get().post_title||t.Posts.data.l10n.noTitle,l="post-"+String(s),(d=e("#menu-item-tpl-"+l)).length&&(o=d.find(".menu-item-title:first"),e.trim(a)!==e.trim(o.text())&&o.text(a),"publish"!==i.get().post_status&&d.is(":visible")?d.hide():"publish"!==i.get().post_status||d.is(":visible")||d.show()),(r=t.Menus.availableMenuItemsPanel.collection.get(l))&&r.set("title",a)))},i.ajaxPrefilterAvailableNavMenuItemRequests=function(i){var n;"POST"===i.type.toUpperCase()&&((n=document.createElement("a")).href=i.url,/wp-admin\/admin-ajax\.php$/.test(n.pathname)&&/(^|&)action=(search-available-menu-items-customizer|load-available-menu-items-customizer)(&|$)/.test(i.data)&&(i.data+="&",i.data+=e.param({customized:t.previewer.query().customized})))},t.bind("ready",function(){t.control.each(i.extendNavMenuItemOriginalObjectReference),t.control.bind("add",i.extendNavMenuItemOriginalObjectReference),t.bind("change",i.watchPostSettingChanges),t.requestChangesetUpdate||e.ajaxPrefilter(i.ajaxPrefilterAvailableNavMenuItemRequests)}),i}(wp.customize,jQuery);