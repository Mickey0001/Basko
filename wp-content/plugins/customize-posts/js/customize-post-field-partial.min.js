!function(e,t){"use strict";e.selectiveRefresh.partialConstructor.post_field=e.selectiveRefresh.partialConstructor.deferred.extend({initialize:function(t,i){var r,s,a=this,n=/^post\[(.+?)]\[(-?\d+)]\[(.+?)](?:\[(.+?)])?$/;if(r=i||{},r.params=r.params||{},!(s=t.match(n)))throw new Error("Bad PostFieldPartial id. Expected post[:post_type][:post_id][:field_id]");r.params.post_type=s[1],r.params.post_id=parseInt(s[2],10),r.params.field_id=s[3],r.params.placement=s[4]||"",e.selectiveRefresh.partialConstructor.deferred.prototype.initialize.call(a,t,r),a.addInstantPreviews()},addInstantPreviews:function(){var i,r=this;if(1!==r.settings().length)throw new Error("Expected one single setting.");i=r.settings()[0],"post_title"===r.params.field_id&&e(i,function(e){e.bind(function(e,i){!e||i&&e.post_title===i.post_title||(_.each(r.placements(),function(t){var i=t.container.find("> a");i.length||(i=t.container),i.text(e.post_title)}),"page"===r.params.post_type&&t(".page_item.page-item-"+r.params.post_id+":not(.menu-item) > a").text(e.post_title))})})},refresh:function(){var i,r=this;return e.previewPosts.data.isSingular||-1===_.indexOf(e.previewPosts.data.queriedOrderbyFields,r.params.field_id)?((i=e.selectiveRefresh.partialConstructor.deferred.prototype.refresh.call(r)).done(function(){r.hadInvalidSettings=!1,_.each(r.settings(),function(t){var i=e.settingValidities(t);i&&!0!==i.get()&&(r.hadInvalidSettings=!0)})}),i):(e.selectiveRefresh.requestFullRefresh(),(i=t.Deferred()).reject(),i)},fallback:function(){var i,r=this;(i=r.params.fallbackDependentSelector)||(i=".hentry.post-%d, body.page-id-%d, body.postid-%d"),i=i.replace(/%d/g,String(r.params.post_id)),0!==t(i).length&&e.selectiveRefresh.partialConstructor.deferred.prototype.fallback.call(r)},showControl:function(){var t=this,i=t.params.primarySetting;i||(i=_.first(t.settings())),e.preview.send("focus-control",i+"["+t.params.field_id+"]")},placements:function(){var t,i=this;return t=e.selectiveRefresh.partialConstructor.deferred.prototype.placements.call(this),t=_.filter(t,function(e){var t=e.container.closest(".hentry");return!t.length||t.hasClass("post-"+String(i.params.post_id))})},isRelatedSetting:function(t,i,r){var s=this;return!(!s.hadInvalidSettings&&_.isObject(i)&&_.isObject(r)&&s.params.field_id&&i[s.params.field_id]===r[s.params.field_id])&&e.selectiveRefresh.partialConstructor.deferred.prototype.isRelatedSetting.call(s,t,i,r)}})}(wp.customize,jQuery);