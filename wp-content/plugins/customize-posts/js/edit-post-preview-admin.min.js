var EditPostPreviewAdmin=function(e){"use strict";var t={data:{customize_url:null,is_compat:!1,previewed_post:null,customize_posts_update_changeset_nonce:null}};return"undefined"!=typeof _editPostPreviewAdminExports&&e.extend(t.data,_editPostPreviewAdminExports),t.init=function(){t.previewButton=e("#post-preview"),t.previewButtonSpinner=e("span.spinner").first().clone(),t.previewButton.after(t.previewButtonSpinner),t.previewButton.off("click.post-preview").on("click.post-preview",t.onClickPreviewBtn)},t.onClickPreviewBtn=function(o){var s,i,n,r,a,p,c=e(this),u=e("#post_ID").val(),d=e("#post_type").val(),l={},m=tinymce.get("content");o.preventDefault(),c.hasClass("disabled")||(wp.customize.Loader.link=c,n=wp.customize.Loader.settings.browser.mobile,wp.customize.Loader.settings.browser.mobile=!1,wp.customize.Loader.close=t.closeLoader,(r=parseInt(e("#parent_id").val(),10))||(r=0),(a=parseInt(e("#menu_order").val(),10))||(a=0),i={post_title:e("#title").val(),post_name:e("#post_name").val(),post_parent:r,menu_order:a,post_content:m&&!m.isHidden()?wp.editor.removep(m.getContent()):e("#content").val(),post_excerpt:e("#excerpt").val(),comment_status:e("#comment_status").prop("checked")?"open":"closed",ping_status:e("#ping_status").prop("checked")?"open":"closed",post_author:parseInt(e("#post_author_override").val(),10)},l[s="post["+d+"]["+u+"]"]=i,wp.customize.trigger("settings-from-edit-post-screen",l),t.data.is_compat?(sessionStorage.setItem("previewedCustomizePostSettings["+u+"]",JSON.stringify(l)),wp.customize.Loader.open(t.data.customize_url),wp.customize.Loader.settings.browser.mobile=n,t.bindChangesFromCustomizer(s,m)):(c.addClass("disabled"),t.previewButtonSpinner.addClass("is-active is-active-preview"),(p=wp.ajax.post("customize_posts_update_changeset",{customize_posts_update_changeset_nonce:t.data.customize_posts_update_changeset_nonce,previewed_post:t.data.previewed_post,customize_url:t.data.customize_url,input_data:i})).fail(function(e){var t,o=JSON.parse(e.responseText);o.data&&(t=o.data.replace(/_/g," "),alert(t.charAt(0).toUpperCase()+t.slice(1)))}),p.done(function(e){wp.customize.Loader.open(e.customize_url),wp.customize.Loader.settings.browser.mobile=n,t.bindChangesFromCustomizer(s,m)}),p.always(function(){c.removeClass("disabled"),t.previewButtonSpinner.removeClass("is-active is-active-preview")})))},t.bindChangesFromCustomizer=function(t,o){wp.customize.Loader.messenger.bind("customize-post-settings-data",function(s){var i;s[t]&&(e("#title").val(s[t].post_title).trigger("change"),o&&o.setContent(wp.editor.autop(s[t].post_content)),e("#content").val(s[t].post_content).trigger("change"),e("#excerpt").val(s[t].post_excerpt).trigger("change"),e("#comment_status").prop("checked","open"===s[t].comment_status).trigger("change"),e("#ping_status").prop("checked","open"===s[t].ping_status).trigger("change"),e("#post_author_override").val(s[t].post_author).trigger("change"),e("#post_name").val(s[t].post_name).trigger("change"),i=s[t].post_parent,e("#parent_id").val(i>0?String(i):"").trigger("change"),e("#menu_order").val(String(s[t].menu_order)).trigger("change"),e("#new-post-slug").val(s[t].post_name),e("#editable-post-name, #editable-post-name-full").text(s[t].post_name)),wp.customize.trigger("settings-from-customizer",s)})},t.getPostMetaSettingId=function(t){var o;return o=e("#post_ID").val(),"postmeta["+e("#post_type").val()+"]["+o+"]["+t+"]"},t.closeLoader=function(){this.active&&(this.active=!1,this.trigger("close"),this.originalDocumentTitle&&(document.title=this.originalDocumentTitle),this.link&&this.link.focus())},t}(jQuery);