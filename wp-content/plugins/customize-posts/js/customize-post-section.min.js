!function(t,o){"use strict";var i,e;t.Posts||(t.Posts={}),i=t.Element.synchronizer.checkbox.update,e=t.Element.synchronizer.checkbox.refresh,_.extend(t.Element.synchronizer.checkbox,{update:function(t){var o;o=_.isUndefined(this.element.data("on-value"))||_.isUndefined(this.element.data("off-value"))?t:t===this.element.data("on-value"),i.call(this,o)},refresh:function(){return _.isUndefined(this.element.data("on-value"))||_.isUndefined(this.element.data("off-value"))?e.call(this):this.element.prop("checked")?this.element.data("on-value"):this.element.data("off-value")}}),t.Posts.PostSection=t.Section.extend({initialize:function(i,e){var s,n,a,r=this;if(s=e||{},s.params=s.params||{},!t.Posts.data.postTypes[s.params.post_type])throw new Error("Missing post_type");if(_.isNaN(s.params.post_id))throw new Error("Missing post_id");if(!(n=t(i))||!n())throw new Error("Setting must be created up front.");n.findControls=r.findPostSettingControls,s.params.title||(s.params.title=t(i).get().post_title),s.params.title||(s.params.title=t.Posts.data.l10n.noTitle),"page"===s.params.post_type&&n.bind(function(t,o){r.syncPageData(t,o)}),r.postFieldControls={},r.contentsEmbedded=o.Deferred(),a=void 0===s.params.priority,t.Section.prototype.initialize.call(r,i,s),a&&r.derivePriority(),r.active.validate=function(){return!0}},derivePriority:function(){var o,i,e,s=this;e=t.Posts.data.postTypes[s.params.post_type],o=t(s.id),(i=function(t){var o;t&&!s.expanded.get()&&(e.hierarchical||e.supports["page-attributes"]?o=t.menu_order:(o=Date.parse(t.post_date.replace(" ","T")),o=isNaN(o)?0:(new Date).valueOf()-o),s.priority.set(o))})(o()),o.bind(i),s.expanded.bind(function(t){t||i(o())})},ready:function(){function o(t){t&&(i.contentsEmbedded.resolve(),i.expanded.unbind(o))}var i=this,e=i.expanded();i.setupTitleUpdating(),i.contentsEmbedded.done(function(){i.embedSectionContents()}),t.Section.prototype.ready.call(i),t.settings.autofocus.section===i.id&&(e=!0),t.settings.autofocus.control&&0===t.settings.autofocus.control.replace(/^postmeta/,"post").indexOf(i.id)&&(e=!0),e?i.contentsEmbedded.resolve():i.expanded.bind(o),t.Section.prototype.ready.call(i)},embedSectionContents:function(){var t=this;t.setupSectionNotifications(),t.setupPostNavigation(),t.setupControls()},setupTitleUpdating:function(){var o,i,e,s,n=this,a=t(n.id);o=n.container.closest(".accordion-section"),i=o.find(".accordion-section-title:first"),e=o.find(".customize-section-title h3").first(),s=e.find(".customize-action").first(),a.bind(function(o,n){var a;o.post_title!==n.post_title&&"trash"!==o.post_status&&(a=o.post_title||t.Posts.data.l10n.noTitle,i.text(a),e.text(a),e.prepend(s))})},setupPostNavigation:function(){var i,e,s,n,a=this,r=t(a.id);e=a.container.closest(".accordion-section").find(".customize-section-title:first"),s=wp.template("customize-posts-navigation"),(n=t.Posts.data.postTypes[a.params.post_type]).public&&(i=o(s({label:n.labels.singular_name})),e.append(i),i.toggle(a.params.post_id!==t.Posts.previewedQuery.get().queriedPostId),t.Posts.previewedQuery.bind(function(t){i.toggle(a.params.post_id!==t.queriedPostId&&"trash"!==r.get().post_status)}),i.on("click",function(o){o.preventDefault(),t.previewer.previewUrl(t.Posts.getPreviewUrl({post_id:a.params.post_id,post_type:a.params.post_type}))}))},setupControls:function(){var o,i=this;(o=t.Posts.data.postTypes[i.params.post_type]).supports.title&&i.addTitleControl(),(o.supports.title||o.supports.slug)&&i.addSlugControl(),"undefined"==typeof EditPostPreviewCustomize&&(i.addStatusControl(),i.addDateControl()),(o.supports["page-attributes"]||o.supports.parent)&&i.addParentControl(),(o.supports["page-attributes"]||o.supports.ordering)&&i.addOrderControl(),o.supports.editor&&i.addContentControl(),o.supports.excerpt&&i.addExcerptControl(),(o.supports.comments||o.supports.trackbacks)&&i.addDiscussionFieldsControl(),o.supports.author&&i.addAuthorControl()},addPostFieldControlNotification:function(o,i){var e,s;return s="string"==typeof o?o:o.code,e=-1!==s.indexOf(":")||o.setting,o.data&&o.data.setting_property===this.setting_property||!e?(t.Notifications||t.Values).prototype.add.call(this,o,i):null},findPostSettingControls:function(){var o,i=[],e=[];return o=t.Setting.prototype.findControls.call(this),this.notifications.each(function(t){t.data&&t.data.setting_property&&e.push(t.data.setting_property)}),_.each(o,function(t){-1!==_.indexOf(e,t.params.setting_property)&&i.push(t)}),i.length>0&&(o=i),o},isPageForPosts:function(){var o=this;return"page"===o.params.post_type&&(!!t.has("page_for_posts")&&parseInt(t("page_for_posts").get(),10)===o.params.post_id)},addTitleControl:function(){var i,e,s=this,n=t(s.id);return e=t.Posts.data.postTypes[s.params.post_type],i=new t.controlConstructor.dynamic(s.id+"[post_title]",{params:{section:s.id,priority:10,label:e.labels.title_field?e.labels.title_field:t.Posts.data.l10n.fieldTitleLabel,active:!0,settings:{default:n.id},field_type:"text",setting_property:"post_title"}}),s.postFieldControls.post_title=i,t.control.add(i.id,i),i.deferred.embedded.done(function(){i.container.find("input[type=text]").on("focus",function(){t.Posts.data.l10n.noTitle===i.setting().post_title&&o(this).select()})}),i.notifications&&(i.notifications.add=s.addPostFieldControlNotification,i.notifications.setting_property=i.params.setting_property),i},addSlugControl:function(){var o,i,e=this,s=t(e.id);return i=t.Posts.data.postTypes[e.params.post_type],(o=new t.controlConstructor.dynamic(e.id+"[post_name]",{params:{section:e.id,priority:20,label:i.labels.slug_field?i.labels.slug_field:t.Posts.data.l10n.fieldSlugLabel,active:!0,settings:{default:s.id},field_type:"text",setting_property:"post_name"}})).deferred.embedded.done(function(){function i(){var o=t.Posts.sanitizeTitleWithDashes(s.get().post_title);e.prop("placeholder",o)}var e=o.container.find("input");i(),s.bind(i)}),e.postFieldControls.post_name=o,t.control.add(o.id,o),o.notifications&&(o.notifications.add=e.addPostFieldControlNotification,o.notifications.setting_property=o.params.setting_property),o},addStatusControl:function(){var o,i,e=this,s=t(e.id);return i=t.Posts.data.postTypes[e.params.post_type],o=new t.controlConstructor.post_status(e.id+"[post_status]",{params:{section:e.id,priority:30,label:i.labels.status_field?i.labels.status_field:t.Posts.data.l10n.fieldStatusLabel,settings:{default:s.id}}}),e.postFieldControls.post_status=o,t.control.add(o.id,o),o.notifications&&(o.notifications.add=e.addPostFieldControlNotification,o.notifications.setting_property=o.params.setting_property),o},addDateControl:function(){var o,i,e=this,s=t(e.id);return i=t.Posts.data.postTypes[e.params.post_type],o=new t.controlConstructor.post_date(e.id+"[post_date]",{params:{section:e.id,priority:40,label:i.labels.date_field?i.labels.date_field:t.Posts.data.l10n.fieldDateLabel,description:t.Posts.data.l10n.fieldDateDescription,settings:{default:s.id}}}),e.postFieldControls.post_date=o,t.control.add(o.id,o),o.notifications&&(o.notifications.add=e.addPostFieldControlNotification,o.notifications.setting_property=o.params.setting_property),o},addContentControl:function(){var i,e,s,n=this,a=t(n.id);return e=t.Posts.data.postTypes[n.params.post_type],s=function(){return!n.isPageForPosts()||""!==o.trim(a.get().post_content)},i=new t.controlConstructor.post_editor(n.id+"[post_content]",{params:{section:n.id,priority:50,label:e.labels.content_field?e.labels.content_field:t.Posts.data.l10n.fieldContentLabel,setting_property:"post_content",active:s(),settings:{default:a.id}}}),t("page_for_posts",function(t){t.bind(function(){i.active.set(s())})}),i.active.validate=s,n.postFieldControls.post_content=i,t.control.add(i.id,i),i.notifications&&(i.notifications.add=n.addPostFieldControlNotification,i.notifications.setting_property=i.params.setting_property),i},addExcerptControl:function(){var o,i,e=this,s=t(e.id);return i=t.Posts.data.postTypes[e.params.post_type],o=new t.controlConstructor.dynamic(e.id+"[post_excerpt]",{params:{section:e.id,priority:60,label:i.labels.excerpt_field?i.labels.excerpt_field:t.Posts.data.l10n.fieldExcerptLabel,active:!0,settings:{default:s.id},field_type:"textarea",setting_property:"post_excerpt"}}),e.postFieldControls.post_excerpt=o,t.control.add(o.id,o),o.notifications&&(o.notifications.add=e.addPostFieldControlNotification,o.notifications.setting_property=o.params.setting_property),o},addParentControl:function(){var o,i,e,s,n=this,a=t(n.id);return s=t.Posts.data.postTypes[n.params.post_type],i=n.id+"[post_parent]",e={section:n.id,priority:70,label:s.labels.parent_item_colon?s.labels.parent_item_colon.replace(/:$/,""):t.Posts.data.l10n.fieldParentLabel,active:!0,settings:{default:a.id},field_type:"select",setting_property:"post_parent"},o=t.controlConstructor.object_selector?new t.controlConstructor.object_selector(i,{params:_.extend(e,{post_query_vars:{post_type:n.params.post_type,post_status:"publish",post__not_in:[n.params.post_id],show_initial_dropdown:!0,dropdown_args:{exclude_tree:n.params.post_id,sort_column:"menu_order, post_title"},apply_dropdown_args_filters_post_id:n.params.post_id},show_add_buttons:!1,select2_options:{multiple:!1,allowClear:!0,placeholder:s.labels.search_items}})}):new t.controlConstructor.dynamic(i,{params:_.extend(e,{field_type:"hidden",description:t.Posts.data.l10n.installCustomizeObjectSelector})}),n.postFieldControls.page_parent=o,t.control.add(o.id,o),o.notifications&&(o.notifications.add=n.addPostFieldControlNotification,o.notifications.setting_property=o.params.setting_property),o},addOrderControl:function(){var o,i,e=this,s=t(e.id);return i=t.Posts.data.postTypes[e.params.post_type],o=new t.controlConstructor.dynamic(e.id+"[menu_order]",{params:{section:e.id,priority:80,label:i.labels.order_field?i.labels.order_field:t.Posts.data.l10n.fieldOrderLabel,active:!0,settings:{default:s.id},field_type:"number",setting_property:"menu_order"}}),e.postFieldControls.menu_order=o,t.control.add(o.id,o),o.notifications&&(o.notifications.add=e.addPostFieldControlNotification,o.notifications.setting_property=o.params.setting_property),o},addDiscussionFieldsControl:function(){var o,i,e=this,s=t(e.id);return o=t.Posts.data.postTypes[e.params.post_type],i=new t.controlConstructor.post_discussion_fields(e.id+"[discussion_fields]",{params:{section:e.id,priority:90,label:o.labels.discussion_field?o.labels.discussion_field:t.Posts.data.l10n.fieldDiscusionLabel,active:!0,settings:{default:s.id},post_type_supports:o.supports}}),e.postFieldControls.post_discussion_fields=i,t.control.add(i.id,i),i.notifications&&(i.notifications.add=e.addPostFieldControlNotification,i.notifications.setting_property=i.params.setting_property),i},addAuthorControl:function(){var o,i,e,s=this,n=t(s.id);return i=t.Posts.data.postTypes[s.params.post_type],o=new t.controlConstructor.dynamic(s.id+"[post_author]",{params:{section:s.id,priority:100,label:i.labels.author_field?i.labels.author_field:t.Posts.data.l10n.fieldAuthorLabel,active:!0,settings:{default:n.id},field_type:"select",setting_property:"post_author",choices:t.Posts.data.authorChoices}}),e=n.validate,n.validate=function(t){var o=_.clone(t);return o=e.call(this,o),o.post_author=parseInt(o.post_author,10),o},s.postFieldControls.post_author=o,t.control.add(o.id,o),o.notifications&&(o.notifications.add=s.addPostFieldControlNotification,o.notifications.setting_property=o.params.setting_property),o},polyfillNotifications:function(){var i,e=this;e.notifications||(e.notifications=new t.Values({defaultConstructor:t.Notification}),e.notificationsContainer=o('<div class="customize-control-notifications-container"></div>'),e.notifications.container=e.notificationsContainer,e.notificationsTemplate=wp.template("customize-post-section-notifications"),e.container.find(".customize-section-title").after(e.notificationsContainer),e.getNotificationsContainerElement=function(){return e.notificationsContainer},e.renderNotifications=t.Control.prototype.renderNotifications,i=_.debounce(function(){e.renderNotifications()}),e.notifications.bind("add",function(t){wp.a11y.speak(t.message,"assertive"),i()}),e.notifications.bind("remove",i),e.renderNotifications())},setupSectionNotifications:function(){var o,i,e=this,s=t(e.id);s.notifications&&(e.polyfillNotifications(),s.notifications.bind("add",function(o){var n=new t.Notification(s.id+":"+o.code,_.extend({},o,{template:i}));o.data&&o.data.setting_property&&t.control.has(e.id+"["+o.data.setting_property+"]")||e.notifications.add(n.code,n)}),s.notifications.bind("remove",function(t){e.notifications.remove(s.id+":"+t.code)}),e.notifications.container.on("click",".override-post-conflict",function(t){var o;t.preventDefault(),(o=_.clone(s.get())).post_modified="",s.set(o),_.each(e.postFieldControls,function(t){t.notifications&&t.notifications.remove("post_update_conflict")}),s.notifications.remove("post_update_conflict")}),i=wp.template("customize-post-field-notification"),t.bind("error",function(o){var i,n,a=[];o.update_conflicted_setting_values&&(i=o.update_conflicted_setting_values[s.id])&&(n=s.get(),_.each(i,function(o,i){var e,r;"post_modified"!==i&&o!==n[i]&&(e=t.control(s.id+"["+i+"]"))&&e.notifications&&(r=new t.Notification("post_update_conflict",{message:t.Posts.data.l10n.theirChange.replace("%s",String(o))}),e.notifications.remove(r.code),e.notifications.add(r.code,r),a.push(e))}),e.expanded()&&_.every(e.controls(),function(t){return _.every(a,function(o){return o.id!==t.id||(t.focus(),!1)})}))}),t.bind("save",function(){e.resetPostFieldControlErrorNotifications()}),o=function(){var o="editing_page_for_posts";e.isPageForPosts()?e.notifications.add(o,new t.Notification(o,{message:t.Posts.data.l10n.editingPageForPostsNotice,type:"warning"})):e.notifications.remove(o)},t("page_for_posts",function(t){o(),t.bind(o)}))},resetPostFieldControlErrorNotifications:function(){var t=this;_.each(t.postFieldControls,function(t){t.notifications&&t.notifications.each(function(o){"error"!==o.type||o.data&&o.data.from_server||t.notifications.remove(o.code)})})},isContextuallyActive:function(){return this.active()},syncPageData:function(i){var e=this;"trash"===i.post_status&&_.each([t("page_for_posts"),t("page_on_front")],function(t){t&&parseInt(t.get(),10)===e.params.post_id&&t.set(0)}),t.control.each(function(s){var n,a,r,d,p;"dropdown-pages"===s.params.type&&(r="trash"===i.post_status,(d="publish"===i.post_status)||parseInt(s.setting.get(),10)!==e.params.post_id||s.setting.set(0),p=i.post_title||t.Posts.data.l10n.noTitle,r?p=t.Posts.data.l10n.dropdownPagesOptionTrashed.replace("%s",p):d||(p=t.Posts.data.l10n.dropdownPagesOptionUnpublished.replace("%s",p)),0===(n=(a=s.container.find("select")).find('option[value="'+String(e.params.post_id)+'"]')).length?(n=o(new Option(p,e.params.post_id)),a.append(n)):n.text(p),n.prop("disabled",!d))})},removeFromDropdownPagesControls:function(){var o=this;t.control.each(function(t){"dropdown-pages"===t.params.type&&t.container.find("select").find('option[value="'+String(o.params.post_id)+'"]').remove()})}})}(wp.customize,jQuery);