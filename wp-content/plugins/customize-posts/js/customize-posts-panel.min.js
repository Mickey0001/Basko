!function(t,e){"use strict";t.Posts||(t.Posts={}),t.Posts.PostsPanel=t.Panel.extend({postType:"post",trashNotificationCode:"untrash",ready:function(){var e=this;t.Panel.prototype.ready.call(e),e.params.post_type&&(e.postType=e.params.post_type),e.deferred.embedded.done(function(){e.setupPanelActions()}),t.bind("saved",function(){e.removeTrashNotifications()})},setupPanelActions:function(){var o,s,i,n,a=this;o=a.container.find(".panel-meta:first"),s=wp.template("customize-posts-"+a.postType+"-panel-actions"),i=t.Posts.data.postTypes[a.postType],a.queriedPostSelect2ItemSelectionTemplate=wp.template("customize-posts-"+a.postType+"-panel-select2-selection-item"),a.queriedPostSelect2ItemResultTemplate=wp.template("customize-posts-"+a.postType+"-panel-select2-result-item"),n=e(s({can_create_posts:i.current_user_can.create_posts,add_new_post_label:i.labels.add_new_item})),a.postSelectionLookupSelect2=n.find(".post-selection-lookup").select2({ajax:{transport:function(t,e,o){var s=a.queryPosts({s:t.data.term,paged:t.data.page||1});return s.done(e),s.fail(o),s},delay:250},templateResult:function(t){return a.queriedPostSelect2ItemResultTemplate(t)},templateSelection:function(t){return a.queriedPostSelect2ItemSelectionTemplate(t)},escapeMarkup:function(t){return t},multiple:!1,placeholder:i.labels.search_items,width:"80%"}),a.postSelectionLookupSelect2.on("select2:select",function(){var e,o=a.postSelectionLookupSelect2.val();a.postSelectionLookupSelect2.prop("disabled",!0),o=parseInt(o,10),(e=t.Posts.ensurePosts([o])).done(function(e){var s,n=e[o];n&&(s=-1!==_.indexOf(t.Posts.previewedQuery.get().postIds,o),n.section.focus(),i.public&&!s&&t.previewer.previewUrl(t.Posts.getPreviewUrl({post_type:a.postType,post_id:o})),n.setting.trashedPreviously&&t.Notification&&a.toggleTrashNotification(n))}),e.always(function(){a.postSelectionLookupSelect2.val(null).trigger("change"),a.postSelectionLookupSelect2.prop("disabled",!1)})}),i.current_user_can.create_posts&&n.find(".add-new-post-stub").on("click",function(t){a.onClickAddPostButton(t)}),o.after(n)},queryPosts:function(e){var o,s,i=this;return o="customize-posts-select2-query",s=_.extend(t.previewer.query(),{"customize-posts-nonce":t.settings.nonce["customize-posts"],post_type:i.postType},e||{}),wp.ajax.post(o,s)},onClickAddPostButton:function(o){var s=this,i=e(o.target);o.preventDefault(),t.Posts.startCreatePostFlow({postType:s.postType,initiatingButton:i,restorePreviousUrl:!1})},isContextuallyActive:function(){return this.active()},toggleTrashNotification:function(e){var o,s,i,n=this;o=new t.Notification(n.trashNotificationCode,{type:"info",message:t.Posts.data.l10n.trashPostNotification}),(s=t.control(e.section.id+"[post_status]"))&&"trash"!==s.setting.get().post_status&&(s.notifications.add(n.trashNotificationCode,o),i=function(){s.notifications.remove(n.trashNotificationCode),s.setting.unbind(i)},s.setting.bind(i))},removeTrashNotifications:function(){var e,o=this;t.section.each(function(s){s.extended(t.Posts.PostSection)&&(e=t.control(s.id+"[post_status]"))&&e.notifications&&e.notifications.remove(o.trashNotificationCode)})}})}(wp.customize,jQuery);