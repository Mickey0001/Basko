!function(t,e){"use strict";t.controlConstructor.post_date=t.controlConstructor.dynamic.extend({initialize:function(n,a){var o,d=this;(o={}).params=_.extend({type:"post_date",label:t.Posts.data.l10n.fieldDateLabel,active:!0,setting_property:"post_date",updatePlaceholdersInterval:1e3,updateScheduledCountdownInterval:6e4,choices:t.Posts.data.dateMonthChoices},a.params||{}),t.controlConstructor.dynamic.prototype.initialize.call(d,n,o),d.dateComponentInputs={},d.deferred.embedded.done(function(){d.dateInputs=d.container.find(".date-input"),d.resetTimeButton=d.container.find(".reset-time"),d.timeInfoHandle=d.container.find(".time-info-handle"),d.timeDetailsContainer=d.container.find(".time-details"),d.resetTimeWrap=d.container.find(".wrap-reset-time"),d.scheduledCountdownContainer=d.container.find(".scheduled-countdown"),d.scheduledCountdownTemplate=wp.template("customize-posts-scheduled-countdown"),d.dateInputs.each(function(){var t,n=e(this);t=n.data("component"),d.dateComponentInputs[t]=n}),d.populateInputs(),d.dateInputs.on("input",function(){var e,n;"0000-00-00 00:00:00"===d.setting.get().post_date&&(e=d.parseDateTime(t.Posts.getCurrentTime()),n=function(t,e){var n=d.dateComponentInputs[e];n&&!n.is("select")&&""===n.val()&&n.val(t)},_.each(e,n)),d.populateSetting()}),d.dateInputs.on("blur",function(){d.populateInputs()}),d.setting.bind(function(t,e){t.post_date!==e.post_date&&d.populateInputs(),t.post_date===e.post_date&&t.post_status===e.post_status||d.updateScheduledCountdown()}),t.control(d.id,function(){d.keepUpdatingPlaceholders(),d.keepUpdatingScheduledCountdown()}),d.setting.bind(function(t,e){(t.post_date!==e.post_date&&"0000-00-00 00:00:00"===e.post_date||"0000-00-00 00:00:00"===t.post_date)&&d.updatePlaceholders()}),d.resetTimeButton.on("click",function(){var t;(t=_.clone(d.setting.get())).post_date="0000-00-00 00:00:00",d.setting.set(t)}),d.timeInfoHandle.on("click",function(){d.timeInfoHandle.hasClass("active")?(d.timeInfoHandle.removeClass("active"),d.timeInfoHandle.attr("aria-pressed","false"),d.timeDetailsContainer.attr("aria-expanded","false"),d.timeDetailsContainer.stop().slideUp("fast")):(d.timeInfoHandle.addClass("active"),d.timeInfoHandle.attr("aria-pressed","true"),d.timeDetailsContainer.attr("aria-expanded","true"),d.timeDetailsContainer.stop().slideDown("fast"))})})},updatePlaceholders:function(){var e,n=this;"0000-00-00 00:00:00"===n.setting.get().post_date?(e=n.parseDateTime(t.Posts.getCurrentTime()),_.each(n.dateComponentInputs,function(t,n){t.is("select")?t.val(e[n]):(t.prop("placeholder",e[n]),t.val(""))}),n.resetTimeButton.hide(),n.resetTimeWrap.hide()):(n.dateInputs.prop("placeholder",""),n.resetTimeButton.show(),n.resetTimeWrap.show())},keepUpdatingPlaceholders:function(){var e=this;t.control.has(e.id)?(e.updatePlaceholders(),e.updatePlaceholdersIntervalId=setTimeout(function(){e.keepUpdatingPlaceholders()},e.params.updatePlaceholdersInterval)):e.updatePlaceholdersIntervalId=null},updateScheduledCountdown:function(){var e,n=this;"future"===n.setting.get().post_status?(e=t.Posts.parsePostDate(n.setting.get().post_date).valueOf(),e-=t.Posts.parsePostDate(t.Posts.getCurrentTime()).valueOf(),(e=Math.ceil(e/1e3))>0?(n.scheduledCountdownContainer.text(n.scheduledCountdownTemplate({remainingTime:e})),n.scheduledCountdownContainer.show()):n.scheduledCountdownContainer.hide()):n.scheduledCountdownContainer.hide()},keepUpdatingScheduledCountdown:function(){var e=this;t.control.has(e.id)?(e.updateScheduledCountdown(),e.updateScheduledCountdownIntervalId=setTimeout(function(){e.keepUpdatingScheduledCountdown()},e.params.updateScheduledCountdownInterval)):e.updateScheduledCountdownIntervalId=null},populateInputs:function(){var t,n=this;return!n.dateInputs.is(":focus")&&"0000-00-00 00:00:00"!==n.setting.get().post_date&&(!!(t=n.parseDateTime(n.setting.get().post_date))&&(_.each(n.dateComponentInputs,function(n,a){e(n).val(t[a])}),!0))},populateSetting:function(){var e,n,a,o,d=this;return a=d.section()+":invalid_date",(e=d.getDateFromInputs())?(e.setSeconds(0),o=_.clone(d.setting.get()),d.notifications.remove(a),o.post_date=t.Posts.formatDate(e),d.setting.set(o),!0):(d.notifications&&(n=new t.Notification(a,{message:t.Posts.data.l10n.invalidDateError}),d.notifications.add(n.code,n)),!1)},getDateFromInputs:function(){var t,e=this;return t=new Date(parseInt(e.dateComponentInputs.year.val(),10),parseInt(e.dateComponentInputs.month.val(),10)-1,parseInt(e.dateComponentInputs.day.val(),10),parseInt(e.dateComponentInputs.hour.val(),10),parseInt(e.dateComponentInputs.minute.val(),10)),isNaN(t.valueOf())?null:t},parseDateTime:function(t){var e=t.match(/^(\d\d\d\d)-(\d\d)-(\d\d) (\d\d):(\d\d):(\d\d)$/);return e?(e.shift(),{year:e.shift(),month:e.shift(),day:e.shift(),hour:e.shift(),minute:e.shift(),second:e.shift()}):null}})}(wp.customize,jQuery);